Bootstrap: docker
From: alpine:3.9

%help

    krakenuniq 0.5.8
    https://github.com/fbreitwieser/krakenuniq

%labels

    MAINTAINER "Tom Harrop"
    VERSION "krakenuniq 0.5.8"

%post

    # dependencies
    apk add --update \
        bash \
        build-base \
        git \
        perl \
        perl-app-cpanminus \
        perl-dev \
        wget \
        zlib-dev

    # intall perl modules
    cpanm LWP::Simple

    # install ncbi blast+
    # can't compile because of broken alpine libc
    # have to use NCBI binaries
    wget -O blast.tar.gz \
        ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/2.9.0/ncbi-blast-2.9.0+-x64-linux.tar.gz
    mkdir blast
    tar -zxf blast.tar.gz \
        -C blast \
        --strip-components 1
    rm -f blast.tar.gz

    # install krakenuniq
    wget -O krakenuniq.tar.gz \
        --no-check-certificate \
        https://github.com/fbreitwieser/krakenuniq/archive/v0.5.8.tar.gz

    mkdir krakenuniq
    tar -zxf krakenuniq.tar.gz \
        -C krakenuniq \
        --strip-components 1
    cd krakenuniq || exit 1
    ./install_krakenuniq.sh -j /usr/local/bin
    cd .. || exit 1
    rm -rf krakenuniq krakenuniq.tar.gz

%environment

    export PATH="${PATH}:/blast/bin"

%runscript

    exec /usr/local/bin/krakenuniq "$@"
