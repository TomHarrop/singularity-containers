Bootstrap: docker
From: ubuntu:18.10

%help
    Quast 5.0.2
    http://quast.bioinf.spbau.ru/

%labels
    MAINTAINER "Tom Harrop"
    VERSION "QUAST 5.0.2"

%post
    # deps
    apt-get clean
    apt-get update
    apt-get install -y \
        build-essential \
        default-jre \
        language-pack-en \
        libfreetype6-dev \
        libgd-perl \
        libpng-dev \
        libtime-hr-perl \
        pkg-config \
        python \
        python-matplotlib \
        python-pip \
        python-setuptools \
        r-base-dev \
        zlib1g-dev \
        wget

    # install circos
    perl -MCPAN -e \
        'install Config::General ; \
        install Clone ; \
        install Font::TTF::Font ; \
        install List::MoreUtils ; \
        install Math::Bezier ; \
        install Math::Round ; \
        install Math::VecStat ; \
        install Params::Validate ; \
        install Readonly ; \
        install Regexp::Common ; \
        install SVG ; \
        install Set::IntSpan ; \
        install Statistics::Basic ; \
        install Text::Format'

    mkdir circos
    wget -O "circos.tar.gz" \
        http://circos.ca/distribution/circos-0.69-6.tgz
    tar -zxf circos.tar.gz \
        -C circos \
        --strip-components 1
    rm circos.tar.gz
    export PATH="${PATH}:/circos/bin"
    circos -modules

    # install quast
    mkdir quast
    wget -O "quast.tar.gz" \
        https://downloads.sourceforge.net/project/quast/quast-5.0.2.tar.gz
    tar -zxf quast.tar.gz \
        -C quast \
        --strip-components 1
    cd quast || exit 1
    ./setup.py install_full
    ./setup.py test
    mv quast_test_output ../
    cd .. || exit 1
    rm -r quast quast.tar.gz

%environment
    export PATH="${PATH}:/circos/bin"

%runscript
    exec /usr/local/bin/quast.py "$@"

